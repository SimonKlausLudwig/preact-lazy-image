!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("preact")):"function"==typeof define&&define.amd?define(["preact"],e):t.myWidget=e(t.preact)}(this,function(t){return function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.componentWillMount=function(){this.init(this.props)},e.prototype.componentDidMount=function(){this.observe()},e.prototype.componentWillUnmount=function(){this.unobserve()},e.prototype.componentWillReceiveProps=function(t,e){t.src!==this.props.src&&(this.unobserve(),this.init(t),this.observe())},e.prototype.init=function(t){this.setState({url:t.placeholder})},e.prototype.unobserve=function(){this.observer&&this.observer.unobserve(this.img)},e.prototype.observe=function(){var t=this,e=this;this.observer=new IntersectionObserver(function(o){o.forEach(function(o){o.intersectionRatio>0&&(t.loadRealImage(e.props.src),t.observer.unobserve(o.target))})},{rootMargin:this.props.rootMargin||"150px 0px",threshold:.1}),this.observer.observe(this.img)},e.prototype.loadRealImage=function(t){var e=this;this.loadImage(t,function(o){e.setState({url:t,loaded:!0})})},e.prototype.loadImage=function(t,e){if(this.img.src.endsWith(t))return console.log("image already loaded!"),void e();var o=new Image;o.onload=e,o.src=t},e.prototype.render=function(){var t,e=this;return h("div",{className:(void 0).wrapper},h("img",{ref:function(t){return e.img=t},className:classNames((t={},t[(void 0).hidden]=!this.state.loaded,t),this.props.className),src:this.state.url}),h("img",{className:(void 0).backup,src:this.props.backup||this.props.placeholder}))},e}(t.Component)});
//# sourceMappingURL=index.umd.js.map
