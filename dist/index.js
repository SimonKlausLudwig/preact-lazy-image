var t=require("preact");module.exports=function(t){function o(){t.apply(this,arguments)}return t&&(o.__proto__=t),(o.prototype=Object.create(t&&t.prototype)).constructor=o,o.prototype.componentWillMount=function(){this.init(this.props)},o.prototype.componentDidMount=function(){this.observe()},o.prototype.componentWillUnmount=function(){this.unobserve()},o.prototype.componentWillReceiveProps=function(t,o){t.src!==this.props.src&&(this.unobserve(),this.init(t),this.observe())},o.prototype.init=function(t){this.setState({url:t.placeholder})},o.prototype.unobserve=function(){this.observer&&this.observer.unobserve(this.img)},o.prototype.observe=function(){var t=this,o=this;this.observer=new IntersectionObserver(function(e){e.forEach(function(e){e.intersectionRatio>0&&(t.loadRealImage(o.props.src),t.observer.unobserve(e.target))})},{rootMargin:this.props.rootMargin||"150px 0px",threshold:.1}),this.observer.observe(this.img)},o.prototype.loadRealImage=function(t){var o=this;this.loadImage(t,function(e){o.setState({url:t,loaded:!0})})},o.prototype.loadImage=function(t,o){if(this.img.src.endsWith(t))return console.log("image already loaded!"),void o();var e=new Image;e.onload=o,e.src=t},o.prototype.render=function(){var t,o=this;return h("div",{className:(void 0).wrapper},h("img",{ref:function(t){return o.img=t},className:classNames((t={},t[(void 0).hidden]=!this.state.loaded,t),this.props.className),src:this.state.url}),h("img",{className:(void 0).backup,src:this.props.backup||this.props.placeholder}))},o}(t.Component);
//# sourceMappingURL=index.js.map
